# æ¸¸æˆçª—å£è’™ç‰ˆç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æ¸¸æˆçª—å£è’™ç‰ˆç³»ç»Ÿä¸ºæ¸¸æˆè‡ªåŠ¨åŒ–æä¾›äº†ç²¾ç¡®çš„åæ ‡èŒƒå›´ç®¡ç†å’Œå¯è§†åŒ–åŠŸèƒ½ã€‚é€šè¿‡å®šä¹‰ä¸åŒçš„åŒºåŸŸï¼Œç³»ç»Ÿå¯ä»¥å‡†ç¡®å®šä½æ¸¸æˆç•Œé¢ä¸­çš„æŒ‰é’®ã€èœå•å’Œå…¶ä»–äº¤äº’å…ƒç´ ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **çª—å£æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹æ¸¸æˆçª—å£ä½ç½®å’Œå¤§å°
- **åŒºåŸŸç®¡ç†**: å®šä¹‰å’Œç®¡ç†æ¸¸æˆç•Œé¢çš„å„ä¸ªåŠŸèƒ½åŒºåŸŸ
- **ç²¾ç¡®å®šä½**: æä¾›åŒºåŸŸä¸­å¿ƒç‚¹å’Œè¾¹ç•Œåæ ‡
- **å¯è§†åŒ–è’™ç‰ˆ**: æ˜¾ç¤ºåŒºåŸŸè¦†ç›–å›¾ï¼Œä¾¿äºè°ƒè¯•å’Œæ ¡å‡†
- **é…ç½®æŒä¹…åŒ–**: ä¿å­˜å’ŒåŠ è½½åŒºåŸŸé…ç½®

### ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§
- **é€æ˜åº¦æ”¯æŒ**: ä¸åŒåŒºåŸŸå¯è®¾ç½®ä¸åŒçš„é€æ˜åº¦
- **é¢œè‰²ç¼–ç **: æ¯ä¸ªåŒºåŸŸä½¿ç”¨ä¸åŒé¢œè‰²ä¾¿äºè¯†åˆ«
- **åæ ‡è½¬æ¢**: è‡ªåŠ¨å¤„ç†å±å¹•åæ ‡å’Œçª—å£ç›¸å¯¹åæ ‡
- **å›é€€æœºåˆ¶**: å½“è’™ç‰ˆç³»ç»Ÿå¤±æ•ˆæ—¶è‡ªåŠ¨å›é€€åˆ°åŸºç¡€å®ç°

## é»˜è®¤åŒºåŸŸé…ç½®

ç³»ç»Ÿé¢„å®šä¹‰äº†ä»¥ä¸‹æ¸¸æˆåŒºåŸŸï¼š

| åŒºåŸŸåç§° | åæ ‡èŒƒå›´ | é¢œè‰² | ç”¨é€” |
|---------|----------|------|------|
| `menu_bar` | é¡¶éƒ¨èœå•æ  | çº¢è‰² | æ¸¸æˆé¡¶éƒ¨èœå•åŒºåŸŸ |
| `left_panel` | å·¦ä¾§é¢æ¿ | è“è‰² | å·¦ä¾§åŠŸèƒ½æŒ‰é’®åŒºåŸŸ |
| `game_area` | ä¸­å¤®æ¸¸æˆåŒºåŸŸ | ç»¿è‰² | ä¸»è¦æ¸¸æˆæ“ä½œåŒºåŸŸ |
| `right_panel` | å³ä¾§é¢æ¿ | é’è‰² | å³ä¾§ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ |
| `bottom_bar` | åº•éƒ¨æ“ä½œæ  | ç´«è‰² | åº•éƒ¨æŠ€èƒ½å’Œæ“ä½œåŒºåŸŸ |
| `dialog_area` | å¯¹è¯æ¡†åŒºåŸŸ | ç°è‰² | ä»»åŠ¡å¯¹è¯æ¡†å’Œç¡®è®¤åŒºåŸŸ |
| `reward_area` | å¥–åŠ±åŒºåŸŸ | é»„è‰² | å¥–åŠ±è·å¾—å’Œæ”¶é›†åŒºåŸŸ |
| `retry_button` | å†æ¬¡æŒ‘æˆ˜æŒ‰é’® | æ©™è‰² | å†æ¬¡æŒ‘æˆ˜æŒ‰é’®ä½ç½® |
| `return_button` | è¿”å›æŒ‰é’® | ç™½è‰² | è¿”å›æŒ‰é’®ä½ç½® |
| `mission_select` | ä»»åŠ¡é€‰æ‹©åŒºåŸŸ | æ·±ç´«è‰² | ä»»åŠ¡é€‰æ‹©åˆ—è¡¨åŒºåŸŸ |

## API æ¥å£

### è·å–æ‰€æœ‰åŒºåŸŸä¿¡æ¯
```http
GET /api/overlay/zones
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "retry_button": {
      "name": "å†æ¬¡æŒ‘æˆ˜",
      "rect": {
        "x": 860,
        "y": 700,
        "width": 200,
        "height": 60,
        "center": [960, 730]
      },
      "color": [255, 165, 0],
      "alpha": 80,
      "description": "å†æ¬¡æŒ‘æˆ˜æŒ‰é’®ä½ç½®"
    }
  },
  "window_rect": {
    "x": 54,
    "y": 138,
    "width": 1936,
    "height": 1119
  }
}
```

### ç‚¹å‡»æŒ‡å®šåŒºåŸŸ
```http
POST /api/overlay/zones/{zone_name}/click
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æˆåŠŸç‚¹å‡»åŒºåŸŸ: retry_button"
}
```

### æ£€æµ‹æ¸¸æˆçª—å£
```http
GET /api/overlay/window/detect
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æ¸¸æˆçª—å£æ£€æµ‹æˆåŠŸ",
  "window_rect": {
    "x": 54,
    "y": 138,
    "width": 1936,
    "height": 1119
  }
}
```

### ä¿å­˜/åŠ è½½é…ç½®
```http
POST /api/overlay/config/save
POST /api/overlay/config/load
```

### è·å–æŒ‡å®šåŒºåŸŸä¿¡æ¯
```http
GET /api/overlay/zone/{zone_name}
```

## Python API ä½¿ç”¨

### åŸºç¡€ä½¿ç”¨

```python
from core.window_overlay import window_overlay

# æ£€æµ‹æ¸¸æˆçª—å£
success = window_overlay.detect_game_window()
if success:
    print(f"æ¸¸æˆçª—å£: {window_overlay.window_rect}")

# ç‚¹å‡»åŒºåŸŸä¸­å¿ƒ
if window_overlay.click_zone("retry_button"):
    print("ç‚¹å‡»å†æ¬¡æŒ‘æˆ˜æŒ‰é’®æˆåŠŸ")

# è·å–åŒºåŸŸä¸­å¿ƒåæ ‡
center = window_overlay.get_zone_center("reward_area")
if center:
    print(f"å¥–åŠ±åŒºåŸŸä¸­å¿ƒ: {center}")
```

### åŒºåŸŸç®¡ç†

```python
from core.window_overlay import window_overlay, ZoneConfig, Rectangle

# æ·»åŠ è‡ªå®šä¹‰åŒºåŸŸ
custom_zone = ZoneConfig(
    name="è‡ªå®šä¹‰åŒºåŸŸ",
    rect=Rectangle(100, 100, 200, 150),
    color=(255, 255, 255),
    alpha=50,
    description="è¿™æ˜¯æˆ‘çš„è‡ªå®šä¹‰åŒºåŸŸ"
)
window_overlay.add_zone(custom_zone)

# æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨åŒºåŸŸå†…
zone = window_overlay.get_zone_at_position(150, 125)
if zone:
    print(f"ç‚¹(150, 125)åœ¨åŒºåŸŸå†…: {zone.name}")

# åˆ é™¤åŒºåŸŸ
window_overlay.remove_zone("è‡ªå®šä¹‰åŒºåŸŸ")
```

### å¯è§†åŒ–å’Œè°ƒè¯•

```python
# æ˜¾ç¤ºè’™ç‰ˆï¼ˆ5ç§’ï¼‰
window_overlay.show_overlay(duration=5.0)

# äº¤äº’å¼æ ¡å‡†åŒºåŸŸ
window_overlay.calibrate_zone("retry_button")

# è·å–æ‰€æœ‰åŒºåŸŸä¿¡æ¯
zones_info = window_overlay.get_zone_info()
for name, info in zones_info.items():
    print(f"{name}: {info['rect']['center']}")
```

### é…ç½®ç®¡ç†

```python
# ä¿å­˜é…ç½®åˆ°æ–‡ä»¶
window_overlay.save_zone_config("my_zones.json")

# ä»æ–‡ä»¶åŠ è½½é…ç½®
window_overlay.load_zone_config("my_zones.json")
```

## é›†æˆåˆ°æ¸¸æˆæ§åˆ¶å™¨

æ¸¸æˆæ§åˆ¶å™¨å·²ç»é›†æˆäº†è’™ç‰ˆç³»ç»Ÿï¼Œè‡ªåŠ¨ä½¿ç”¨ç²¾ç¡®çš„åŒºåŸŸå®šä½ï¼š

```python
# å†æ¬¡æŒ‘æˆ˜æŒ‰é’®ç‚¹å‡»
window_overlay.click_zone("retry_button")

# è¿”å›æŒ‰é’®ç‚¹å‡»
window_overlay.click_zone("return_button")

# å¥–åŠ±åŒºåŸŸç‚¹å‡»
window_overlay.click_zone("reward_area")
```

å½“è’™ç‰ˆç³»ç»Ÿä¸å¯ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°åŸºç¡€åæ ‡å®ç°ã€‚

## é…ç½®æ–‡ä»¶æ ¼å¼

åŒºåŸŸé…ç½®æ–‡ä»¶é‡‡ç”¨JSONæ ¼å¼ï¼š

```json
{
  "window_rect": {
    "x": 0,
    "y": 0,
    "width": 1920,
    "height": 1080
  },
  "zones": {
    "retry_button": {
      "name": "å†æ¬¡æŒ‘æˆ˜",
      "rect": {
        "x": 860,
        "y": 700,
        "width": 200,
        "height": 60
      },
      "color": [255, 165, 0],
      "alpha": 80,
      "description": "å†æ¬¡æŒ‘æˆ˜æŒ‰é’®ä½ç½®"
    }
  }
}
```

## æ ¡å‡†æŒ‡å—

### è‡ªåŠ¨æ ¡å‡†
ç³»ç»Ÿæä¾›äº†äº¤äº’å¼æ ¡å‡†åŠŸèƒ½ï¼š

```python
# æ ¡å‡†æŒ‡å®šåŒºåŸŸ
window_overlay.calibrate_zone("retry_button")
```

æ ¡å‡†æ—¶ç³»ç»Ÿä¼šï¼š
1. æç¤ºç‚¹å‡»åŒºåŸŸå·¦ä¸Šè§’
2. è®°å½•åæ ‡
3. æç¤ºç‚¹å‡»åŒºåŸŸå³ä¸‹è§’
4. è®°å½•åæ ‡
5. è‡ªåŠ¨è®¡ç®—åŒºåŸŸçŸ©å½¢

### æ‰‹åŠ¨æ ¡å‡†
ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶æ¥è°ƒæ•´åŒºåŸŸåæ ‡ã€‚

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¸¸æˆçª—å£æ£€æµ‹å¤±è´¥**
   - ç¡®ä¿æ¸¸æˆæ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥æ¸¸æˆçª—å£æ ‡é¢˜æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤pygetwindowåº“å·²å®‰è£…

2. **åŒºåŸŸç‚¹å‡»ä¸å‡†ç¡®**
   - é‡æ–°æ ¡å‡†åŒºåŸŸåæ ‡
   - æ£€æŸ¥æ¸¸æˆåˆ†è¾¨ç‡æ˜¯å¦å˜åŒ–
   - ç¡®è®¤æ¸¸æˆçª—å£ä½ç½®

3. **è’™ç‰ˆæ˜¾ç¤ºå¤±è´¥**
   - å®‰è£…OpenCV: `pip install opencv-python`
   - æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ”¯æŒGUIæ˜¾ç¤º

### è°ƒè¯•æŠ€å·§

1. **æ˜¾ç¤ºè’™ç‰ˆå›¾**:
   ```python
   window_overlay.show_overlay(duration=10.0)
   ```

2. **æ£€æŸ¥åŒºåŸŸä¿¡æ¯**:
   ```python
   zones = window_overlay.get_zone_info()
   print(zones)
   ```

3. **æµ‹è¯•ç‚¹å‡»**:
   ```python
   for zone_name in ["retry_button", "return_button"]:
       center = window_overlay.get_zone_center(zone_name)
       if center:
           print(f"{zone_name}: {center}")
   ```

## æ€§èƒ½ä¼˜åŒ–

- è’™ç‰ˆç³»ç»Ÿä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è®¡ç®—
- åŒºåŸŸæ£€æµ‹ä½¿ç”¨é«˜æ•ˆçš„åæ ‡æ¯”è¾ƒç®—æ³•
- å›¾åƒæ¸²æŸ“ä»…åœ¨éœ€è¦æ—¶è¿›è¡Œ

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°åŒºåŸŸç±»å‹

```python
# åˆ›å»ºç‰¹æ®Šç”¨é€”çš„åŒºåŸŸ
inventory_zone = ZoneConfig(
    name="èƒŒåŒ…åŒºåŸŸ",
    rect=Rectangle(1500, 200, 300, 600),
    color=(0, 255, 128),
    alpha=60,
    description="èƒŒåŒ…ç‰©å“ç®¡ç†åŒºåŸŸ"
)
window_overlay.add_zone(inventory_zone)
```

### è‡ªå®šä¹‰æ£€æµ‹é€»è¾‘

```python
def custom_zone_detection(x, y):
    """è‡ªå®šä¹‰åŒºåŸŸæ£€æµ‹é€»è¾‘"""
    zone = window_overlay.get_zone_at_position(x, y)
    if zone and zone.name == "game_area":
        return "åœ¨æ¸¸æˆåŒºåŸŸå†…"
    return "ä¸åœ¨æ¸¸æˆåŒºåŸŸå†…"
```

## æ€»ç»“

æ¸¸æˆçª—å£è’™ç‰ˆç³»ç»Ÿä¸ºè‡ªåŠ¨åŒ–æ“ä½œæä¾›äº†ç²¾ç¡®ã€å¯é çš„åæ ‡ç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ï¼Œå¯ä»¥å¤§å¤§æå‡æ¸¸æˆè‡ªåŠ¨åŒ–çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚

ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ï¼ŒåŒæ—¶æä¾›äº†å®Œå–„çš„APIæ¥å£å’Œè°ƒè¯•å·¥å…·ï¼Œæ–¹ä¾¿å¼€å‘è€…é›†æˆå’Œä½¿ç”¨ã€‚